%1-closeupview
%2-crowdview
CV = [[1,142,1];[259,536,1];[714,772,1];[801,848,1];
    [1821,1910,1];[2229,2344,1];[3556,3631,1];[3917,4035,1];
    [4553,4596,1];[4789,4860,1];[5455,5656,1];[6058,6177,1];
    [6260,6432,1];[6757,6784,1];[7039,7332,1];[7549,8073,1];
    [8413,8572,1];[8601,8850,1];[9128,9196,1];[10122,10188,1];
    [10593,10668,1];[12886,12920,1];[13426,13500,1];
    [14720,14312,1];[16219,16137,1];[16310,16360,1];
    [25359,25409,1];[34553,34572,1];[34613,34639,1];
    [35157,35188,1];[36673,36786,1];[36945,37105,1];
    [1533,1544,1];[4154,4176,1];[4313,4324,1];[4597,4664,1];
    [10537,10568,1];[12742,12765,1];[15878,15900,1];
    [17045,17092,1];[17222,17348,1];[17893,18079,1];
    [18989,19330,1];[24882,24899,1];[32157,32290,1];
    [32507,32516,1];[36493,36552,1];[36945,36968,1];
    [8745,8836,1];
    [1921,2053,2];[2357,2632,2];[8152,8303,2];[8989,9032,2];
    [9066,9127,2];[9332,9340,2];[9457,9541,2];[9969,9987,2];
    [10027,10120,2];[12485,12680,2];[24748,24797,2];[15943,15972,2]];

fName = 'closeup_crowd_svm.csv';
fid = fopen(fName, 'w');

TD = [[773,788,1];[849,875,1];[1006,1070,1];[1769,1794,1];
    [2813,3244,1];[4774,4788,1];[5746,5920,1];[8317,8338,1];
    [8851,8908,1];[9349,9376,1];[9557,9719,1];[10756,10948,1];
    [11211,11311,1];[11363,11524,1];[11781,11808,1];
    [12688,12741,1];[12854,12884,1];[13330,13338,1];
    [13856,13900,1];[13993,14256,1];[14580,14780,1];
    [15575,15744,1];[16571,16621,1];[16637,16762,1];
    [16840,16950,1];[17141,17212,1];[18854,18984,1];
    [33293,33391,1];[33691,33692,1];[33698,33724,1];
    [34033,34105,1];[34941,34980,1];[35052,35107,1];
    [35274,35290,1];[35303,35314,1];[35845,35867,1];
    [35153,35215,1];[37103,37105,1];
    [15746,15784,1];[17675,17708,1];[18158,18191,1];
    [18471,18568,1];[19983,20005,1];[25410,25480,1];
    [32517,32536,1];[36553,36664,1];[36969,37105,1];
    [10445,10467,2];[10677,10744,2];[12474,12484,2];
    [15902,15942,2];[16224,16276,2];[19465,19488,2];
    [21777,21884,2];[23587,23628,2];[30154,30284,2];
    [32707,32721,2]]; %test data
x = 0;

for i = 1:size(CV)
   for j = CV(i, 1):CV(i, 2)
        x = x + 1;
   end
end

no_of_training_data = x;
training_data = zeros(no_of_training_data, 256);
labels = zeros(1, no_of_training_data);
x = 1;

for i = 1:size(CV)
   for j = CV(i, 1):CV(i, 2)
       class = CV(i, 3);
       img = sprintf('../images/img%d.jpg', j);
       disp(sprintf('training - %d - class - %d', j, class));
       fprintf(fid, ',%s,%d,manual\r\n', img, class);
       I = rgb2hsv(im2double(imread(img)));
       I = imhist(I(:,:,1));
       training_data(x,:) = I;
       labels(x) = class;
       x = x + 1;
   end
end
disp('Training svm');
SVMtrainedcv = svmtrain(training_data, labels);

x = 1;
for i = 1:size(TD)
    for j = TD(i,1):TD(i,2)
        class = TD(i, 3);
        img = sprintf('../images/img%d.jpg', j);
        I = rgb2hsv(imread(img));
        test = transp(imhist(I(:,:,1)));
        label = svmclassify(SVMtrainedcv, test);
        disp(sprintf('testing - %d, class - %d', j, label));
        fprintf(fid, ',%s,%d,%d\r\n', img, label, class);       
    end
end

fclose(fid);