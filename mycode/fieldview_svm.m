%1-fieldview
%2-non-fieldview
FV = [[537,557,1];[700,713,1];[1141,1166,1];[1288,1393,1];
    [4094,4112,1];[4135,4153,1];[625,699,1];[4667,4717,1];
    [5262,5301,1];[6178,6207,1];[6788,6823,1];[28877,28906,1];
    [7000,7038,1];[7380,7410,1];[10370,10381,1];[27620,27647,1];
    [20008,20028,1];[28978,29002,1];[29456,29480,1];
    [20035,20067,1];[20108,20138,1];[29502,29513,1];
    [20548,20606,1];[21308,21365,1];[21890,21943,1];
    [22507,22571,1];[9950,9958,1];[10747,10750,1];[24525,24548,1];
    [24030,24070,1];[26013,26064,1];[26288,26400,1];[26619,26633,1];
    [26643,26648,1];[26940,26996,1];[28359,28387,1];[29514,29560,1];
    [29597,29655,1];[30363,30385,1];[30386,30405,1];[30438,30446,1]
    [1,142,2];[259,536,2];[714,890,2];[8152,8305,2];
    [8993,9032,2];[1001,1140,2];[1394,1491,2];
    [1486,1490,2];[1762,1766,2];[714,789,2];
    [8598,8850,2];[793,798,2];[1071,1140,2];[21777,21886,2];
    [23587,23627,2];[1917,2053,2];[2354,2362,2];[7,9,2];[70,99,2];
    [4552,4596,2];[4774,4814,2];[7039,7231,2];[8577,8582,2];
    [8598,8850,2];[9128,9139,2];[9179,9196,2];
    [20863,21306,2]];

fName = 'fieldview_svm.csv';
fid = fopen(fName, 'w');    

TD = [[10382,10390,1];[7470,7503,1];[8074,8098,1];[30059,30085,1];
    [8105,8151,1];[8339,8377,1];[8909,8943,1];[9881,9914,1];
    [2115,2223,1];[2433,2812,1];[3340,3355,1];[3448,3555,1];
    [23137,23165,1];[23446,23476,1];[24106,24206,1];[27663,27673,1];
    [24594,24625,1];[24712,24747,1];[26065,26109,1];[29561,29596,1];
    [894,999,1];[1170,1204,1];[1230,1287,1];[7333,7377,1];
    [7504,7548,1];[8378,8412,1];[8947,8965,1];[1545,1568,1];
    [4333,4545,1];[23193,23213,1];[23490,23557,1];[9398,9448,1];
    [9720,9757,1];[26401,26525,1];[26649,26658,1];[28388,28396,1];
    [28918,28976,1];[30129,30142,1];[30291,30318,1];[30339,30353,1];
    [30406,30437,1];[30447,30485,1];[9066,9127,2];[9329,9340,2];[9455,9544,2];
    [9970,9987,2];[10027,10121,2];[10676,10744,2];[7039,7231,2];
    [7234,7332,2];[7549,8073,2];[8449,8540,2];[4815,4844,2];
    [21427,21883,2];[21972,22132,2]];

x = 0;
for i = 1:size(FV)
   for j = FV(i, 1):FV(i, 2)
        x = x + 1;
   end
end

no_of_training_data = x;

training_data = zeros(no_of_training_data, 256);
labels = zeros(1, no_of_training_data);
x = 1;
for i = 1:size(FV)
   for j = FV(i, 1):FV(i, 2)
       class = FV(i, 3);
       img = sprintf('images/img%d.jpg', j);
       disp(sprintf('training - %d - class - %d', j, class));
       fprintf(fid, ',%s,%d,manual\r\n', img, class);
       I = rgb2hsv(im2double(imread(img)));
       I = imhist(I(:,:,1));
       training_data(x,:) = I;
       labels(x) = class;
       x = x + 1;
   end
end

disp('Training svm');
SVMtrainedfv = svmtrain(training_data, labels);

x = 1;
for i = 1:size(TD)
    for j = TD(i,1):TD(i,2)
        class = TD(i, 3);
        disp(class);
        img = sprintf('images/img%d.jpg', j);
        I = rgb2hsv(imread(img));
        test = transp(imhist(I(:,:,1)));
        label = svmclassify(SVMtrainedfv, test);
        disp(sprintf('testing - %d, label- %d, class - %d', j, label, class));
        fprintf(fid, ',%s,%d,%d\r\n', img, label, class);       
    end
end

fclose(fid);