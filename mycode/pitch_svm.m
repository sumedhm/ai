%1-pitchview
%2-non-pitchview
PV = [[625,713,1];[1141,1166,1];[1205,1222,1];[1288,1393,1];
    [2117,2136,1];[2149,2172,1];[2199,2223,1];[2645,2732,1];
    [2741,2812,1];[3340,3363,1];[4094,4152,1];[4457,4544,1];
    [4667,4717,1];[5262,5328,1];[5333,5453,1];[5927,6048,1];
    [6178,6213,1];[6788,6828,1];[6925,7038,1];[7377,7469,1];
    [10370,10381,1];[10542,10582,1];[10961,11020,1];
    [13953,13980,1];[20008,20028,1];[28978,29002,1];
    [29456,29480,1];[20035,20067,1];[20108,20138,1];
    [20548,20606,1];[21308,21365,1];[21890,21943,1];
    [22507,22571,1];[28877,28906,1];[27620,27647,1];
    [24030,24070,1];[28315,28359,1];
    [30386,30405,1];[30438,30446,1];[26940,26944,1];
    [1653,1760,2];[3256,3316,2];[3385,3447,2];[6853,6884,2];
    [8957,9008,2];[9305,9328,2];[9401,9448,2];[9720,9772,2];
    [9941,9964,2];[10413,10428,2];[16138,16172,2];
    [16461,16470,2];[19375,19409,2];[22965,23000,2];
    [24525,24548,2];[29514,29530,2];[29502,29513,2];
    [590,624,2];[1173,1199,2];[1229,1287,2];[1555,1647,2];
    [3325,3332,2];[4341,4436,2];[6229,6259,2];[7517,7548,2];
    [9034,9065,2];[9990,10024,2];[11749,11776,2];[13781,13850,2];
    [15029,15108,2];[15341,15572,2];[19489,19500,2];[26018,26029,2];
    [26619,26633,2];[26950,26996,2];[28363,28387,2];
    [30135,30142,2];[30363,30380,2];[31374,31395,2];
    [30406,30437,2]];

fName = 'pitchview_svm.csv';
fid = fopen(fName, 'w');    

TD = [[537,578,1];[897,996,1];[2115,2223,1];[2733,2812,1];
    [3340,3355,1];[3448,3555,1];[4737,4772,1];[7360,7377,1];
    [7470,7503,1];[8074,8098,1];[8105,8151,1];[8339,8377,1];
    [8909,8943,1];[9881,9914,1];[10382,10390,1];[11700,11728,1];
    [12260,12282,1];[12379,12413,1];[12791,12807,1];[12825,12853,1];
    [13341,13360,1];[13371,13390,1];[13909,13935,1];
    [14515,14550,1];[15109,15150,1];[15827,15851,1];
    [16041,16068,1];[16765,16796,1];[17453,17500,1];
    [17501,17592,1];[17761,17788,1];[17801,17820,1];
    [18081,18112,1];[18681,18728,1];[19331,19364,1];
    [20008,20040,1];[20110,20140,1];[24594,24625,1];
    [23137,23165,1];[23446,23476,1];[24106,24206,1];
    [24712,24747,1];[26065,26109,1];[29561,29596,1];
    [30957,30970,1];[27663,27673,1];
    [30059,30085,1];[31692,31714,1];[31093,31151,1];
    [27659,27677,1];[28316,28337,1];[28877,28898,1];
    [27620,27644,1];[30291,30318,1];[30447,30490,1];
    [8947,8965,2];[9400,9448,2];[9720,9777,2];
    [12313,12378,2];[19410,19452,2];[20721,20736,2];
    [23001,23088,2];[24525,24547,2];[24965,24980,2];
    [26581,26604,2];[26643,26658,2];[26649,26658,2];
    [15165,15197,2];[16081,16119,2];[16174,16216,2];
    [23197,23213,2];[23509,23557,2];[24637,24711,2];
    [24993,25020,2];[26025,26055,2];[23193,23213,2];
    [26949,26968,2];[23490,23557,2];[28388,28396,2];
    [28925,28976,2];[30339,30353,2];[31396,31406,2];
    [28363,28396,2];[31736,31779,2]];

x = 0;

for i = 1:size(PV)
   for j = PV(i, 1):PV(i, 2)
        x = x + 1;
   end
end

no_of_training_data = x;

training_data = zeros(no_of_training_data, 256);
labels = zeros(1, no_of_training_data);
x = 1;
for i = 1:size(PV)
   for j = PV(i, 1):PV(i, 2)
       class = PV(i, 3);
       img = sprintf('../images/img%d.jpg', j);
       disp(sprintf('training - %d - class - %d', j, class));
       fprintf(fid, ',%s,%d,manual\r\n', img, class);
       I = rgb2hsv(im2double(imread(img)));
       I = imhist(I(:,:,1));
       training_data(x,:) = I;
       labels(x) = class;
       x = x + 1;
   end
end

disp('Training svm');
SVMtrainedpv = svmtrain(training_data, labels);

x = 1;
for i = 1:size(TD)
    for j = TD(i,1):TD(i,2)
        class = TD(i, 3);
        img = sprintf('../images/img%d.jpg', j);
        I = rgb2hsv(imread(img));
        test = transp(imhist(I(:,:,1)));
        label = svmclassify(SVMtrainedpv, test);
        disp(sprintf('testing - %d, class - %d', j, label));
        fprintf(fid, ',%s,%d,%d\r\n', img, label, class);       
    end
end

fclose(fid);